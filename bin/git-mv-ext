#! /bin/bash

color() {
    echo -n "`tput setaf $1`${@:2}"
    # reset color if there are arguments:
    if [[ "$#" > 1 ]]; then echo -n "`tput sgr0`"; fi
}
red() { color 1 "$@"; }
green() { color 2 "$@"; }
yellow() { color 3 "$@"; }
cyan() { color 6 "$@"; }
reset() { color 7 "$@"; echo -n `tput sgr0`; }

SCRIPTNAME=${0##*/}

help() {
  echo ""
  echo "`yellow $SCRIPTNAME`"
  echo "    Update all file extensions in a directory using `cyan git mv`"
  echo ""
  echo "`yellow Usage example`"
  echo "    $SCRIPTNAME .png .final.png"
  echo ""
}

# no args
if [[ "$#" < 2 ]]; then help; exit 0; fi

FROM="$1"
TO="$2"

FROM_LEN=${#FROM}

for ENTRY in *
do
  if [[ "$ENTRY" == *"$FROM" ]]; then
    LEN=${#ENTRY}
    ENDINDEX=$(expr $LEN - $FROM_LEN)
    BASE=${ENTRY:0:$ENDINDEX}
    NEWNAME="$BASE$TO"
    echo "git mv `red $ENTRY` `green $NEWNAME`"
    git mv "$ENTRY" "$NEWNAME"
  fi
done
